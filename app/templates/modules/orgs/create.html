{% extends "base.html" %}

{% block title %}Create Organization - InfoGarden{% endblock %}

{% block content %}
<h1>Create Organization</h1>

<div class="row mt-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-body">
                <form method="POST" enctype="multipart/form-data">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <div class="mb-3">
                        <label for="name" class="form-label">Name *</label>
                        <input type="text" class="form-control" id="name" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label for="description" class="form-label">Description</label>
                        <textarea class="form-control" id="description" name="description" rows="3"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="status" class="form-label">Status *</label>
                        <select class="form-control" id="status" name="status" required>
                            <option value="active" selected>Active</option>
                            <option value="inactive">Inactive</option>
                            <option value="archived">Archived</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="logo" class="form-label">Logo</label>
                        <input type="file" class="form-control" id="logo" name="logo" accept="image/png,image/jpeg,image/jpg,image/gif,image/webp">
                        <small class="form-text text-muted">Accepted formats: PNG, JPG, JPEG, GIF, WEBP</small>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Custom Quick Links</label>
                        <div id="custom-links-container">
                            <!-- Custom links will be added here dynamically -->
                        </div>
                        <button type="button" class="btn btn-sm btn-outline-primary mt-2" id="add-link-btn">
                            <i class="bi bi-plus-circle"></i> Add New Link
                        </button>
                        <small class="form-text text-muted d-block mt-1">Add quick links that are relevant to this organization</small>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">Create</button>
                    <a href="{{ url_for('orgs.index') }}" class="btn btn-secondary">Cancel</a>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const container = document.getElementById('custom-links-container');
    const addBtn = document.getElementById('add-link-btn');
    let linkIndex = 0;
    
    function addLinkRow(label = '', url = '') {
        // Escape HTML to prevent XSS
        const escapeHtml = function(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        };
        
        const row = document.createElement('div');
        row.className = 'custom-link-row mb-2';
        row.innerHTML = `
            <div class="row g-2">
                <div class="col-md-5">
                    <input type="text" class="form-control form-control-sm" 
                           name="custom_link_label[]" 
                           placeholder="Link Label" 
                           value="${escapeHtml(label)}">
                </div>
                <div class="col-md-6">
                    <input type="url" class="form-control form-control-sm" 
                           name="custom_link_url[]" 
                           placeholder="https://example.com" 
                           value="${escapeHtml(url)}">
                </div>
                <div class="col-md-1">
                    <button type="button" class="btn btn-sm btn-outline-danger remove-link-btn">
                        <i class="bi bi-trash"></i>
                    </button>
                </div>
            </div>
        `;
        container.appendChild(row);
        
        // Add remove functionality
        row.querySelector('.remove-link-btn').addEventListener('click', function() {
            row.remove();
        });
        
        linkIndex++;
    }
    
    addBtn.addEventListener('click', function() {
        addLinkRow();
    });
    
    // Add one empty row by default
    addLinkRow();
});
</script>
{% endblock %}

